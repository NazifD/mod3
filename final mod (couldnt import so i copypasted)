rm(list=ls())
pop <- read.csv('pop (1).csv')
flows <- read.csv("county_flows.csv")

df <- merge(pop, flows)

df$in_pct <- df$BtoAflow / df$population2020
df$out_pct <- df$AtoBflow / df$population2020
df$tot_pct <- df$AandBgrossflow / df$population2020
df$net_pct <- df$BtoAnetflow / df$population2020

df$uniq_location <- paste(df$stateAname, df$countyAname)

mean_in <- by(df$in_pct, df$uniq_location, mean)
mean_out <- by(df$out_pct, df$uniq_location, mean)
median_in <- by(df$in_pct, df$uniq_location, median)
median_out <- by(df$out_pct, df$uniq_location, median)
min_in <- by(df$in_pct, df$uniq_location, min)
min_out <- by(df$out_pct, df$uniq_location, min)
max_in <- by(df$in_pct, df$uniq_location, max)
max_out <- by(df$out_pct, df$uniq_location, max)
sd_in <- by(df$in_pct, df$uniq_location, sd)
sd_out <- by(df$out_pct, df$uniq_location, sd)


mean_in <- data.frame(mean_in = mean_in, uniq_location = names(mean_in))
median_in <- data.frame(median_in = median_in, uniq_location = names(median_in))
min_in <- data.frame(min_in = min_in, uniq_location = names(min_in))
max_in <- data.frame(max_in = max_in, uniq_location = names(max_in))
sd_in <- data.frame(sd_in = sd_in, uniq_location = names(sd_in))

mean_out <- data.frame(mean_out = mean_out, uniq_location = names(mean_out))
median_out <- data.frame(median_out = median_out, uniq_location = names(median_out))
min_out <- data.frame(min_out = min_out, uniq_location = names(min_out))
max_out <- data.frame(max_out = max_out, uniq_location = names(max_out))
sd_out <- data.frame(sd_out = sd_out, uniq_location = names(sd_out))


pop$uniq_location <- paste(pop$stateAname, pop$countyAname)
out_df <- merge(pop, mean_in)
out_df <- merge(out_df, median_in)
out_df <- merge(out_df, min_in)
out_df <- merge(out_df, max_in)
out_df <- merge(out_df, sd_in)
out_df <- merge(out_df, mean_out)
out_df <- merge(out_df, median_out)
out_df <- merge(out_df, min_out)
out_df <- merge(out_df, max_out)
out_df <- merge(out_df, sd_out)

write.csv(out_df, 'summary.csv')

